<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Your Details — Vionyx</title>

  <!-- Consent Mode v2 -->
  <script>
    (function () {
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = window.gtag || gtag;

      gtag('consent', 'default', {
        ad_storage: 'denied',
        analytics_storage: 'denied',
        ad_user_data: 'denied',
        ad_personalization: 'denied'
      }, { region: ['GB','IE','DE','FR','NL','ES','IT','SE','NO','DK','FI','AT','BE','PT','PL'] });

      try {
        const saved = JSON.parse(localStorage.getItem('consentChoice') || 'null');
        if (saved && saved.state) gtag('consent', 'update', saved.state);
      } catch(e) {}

      window.applyConsent = function(accept) {
        const state = accept ? {
          ad_storage: 'granted',
          analytics_storage: 'granted',
          ad_user_data: 'granted',
          ad_personalization: 'granted'
        } : {
          ad_storage: 'denied',
          analytics_storage: 'denied',
          ad_user_data: 'denied',
          ad_personalization: 'denied'
        };
        gtag('consent', 'update', state);
        localStorage.setItem('consentChoice', JSON.stringify({ state, ts: Date.now() }));
        var b = document.getElementById('consent-banner'); if (b) b.remove();
      };
    })();
  </script>

  <!-- Google Ads tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17444594729"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17444594729');
  </script>

  <style>
    body{margin:0;font-family:Poppins,system-ui,Arial;background:#0b1720;color:#fff}
    .wrap{max-width:900px;margin:0 auto;padding:2rem}
    h1{margin:.2rem 0 1rem}
    .meta{margin:.6rem 0 1rem;color:#9fdfff}
    .box{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:1rem}
    a.small{color:#9fdfff;text-decoration:none}
    .iframe-wrap{margin-top:.8rem}
    .note{font-size:.9rem;opacity:.85;margin-top:.6rem}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Confirm your details</h1>
    <p id="summary" class="meta"></p>

    <div class="box">
      <div class="iframe-wrap">
        <iframe
          id="jotFormFrame"
          title="Website enquiry"
          style="width:100%;height:1100px;border:0;border-radius:12px;background:#fff"
          src=""
          allow="clipboard-write; fullscreen"
        ></iframe>
      </div>
      <p class="note">All submissions are handled securely by Jotform. If the form doesn’t load, 
        <a class="small" id="openDirect" href="#" target="_blank" rel="noopener">open it in a new tab</a>.
      </p>
      <p style="margin-top:.8rem"><a class="small" href="packages.html">← Back to packages</a></p>
    </div>
  </div>

  <script>
    const JOTFORM_URL = "https://form.jotform.com/252498143333054";

    function normalizeDomain(v){
      v=(v||"").trim().toLowerCase().replace(/^https?:\/\//,"").replace(/^www\./,"");
      if(!v) return "";
      if(!v.includes(".")) return v + ".com";
      return v;
    }
    function loadState(){
      const plan    = sessionStorage.getItem("v_plan") || "";
      const billing = sessionStorage.getItem("v_billing") || "";
      const domain  = normalizeDomain(sessionStorage.getItem("v_domain") || "");
      return { plan, billing, domain };
    }

    (function init(){
      const { plan, billing, domain } = loadState();
      if (!plan || !billing) {
        location.href = "packages.html";
        return;
      }
      const params = new URLSearchParams({
        plan, billing, availability_checked: "true", source_url: location.href
      });
      if (domain) params.set("domain", domain);
      const fullUrl = `${JOTFORM_URL}?${params.toString()}`;
      document.getElementById("jotFormFrame").src = fullUrl;
      document.getElementById("openDirect").href = fullUrl;
      const billTxt = billing === "monthly" ? "Monthly" : (billing === "oneoff" ? "One-off" : billing);
      document.getElementById("summary").textContent =
        `Selected: ${plan} — ${billTxt}` + (domain ? ` | Domain: ${domain}` : ``);
    })();
  </script>

  <!-- Consent banner -->
  <div id="consent-banner" style="
    position:fixed;left:0;right:0;bottom:0;z-index:9999;
    background:rgba(0,0,0,.92);color:#fff;padding:16px;display:flex;gap:12px;
    align-items:center;justify-content:center;flex-wrap:wrap;font:14px/1.4 system-ui,Segoe UI,Roboto,Arial">
    <span style="max-width:820px;opacity:.95">
      We use cookies to analyze traffic and improve your experience. You can accept or reject optional cookies.
    </span>
    <div style="display:flex;gap:8px">
      <button onclick="applyConsent(false)" style="padding:10px 14px;border:1px solid #666;background:#222;color:#fff;border-radius:8px;cursor:pointer">Reject all</button>
      <button onclick="applyConsent(true)" style="padding:10px 14px;border:0;background:linear-gradient(90deg,#0aa0ff,#00f6ff);color:#00222a;border-radius:8px;cursor:pointer;font-weight:700">Accept all</button>
    </div>
  </div>
  <script>
    (function(){
      try { if (localStorage.getItem('consentChoice')) {
        var b = document.getElementById('consent-banner'); if (b) b.remove();
      }} catch(e) {}
    })();
  </script>
</body>
</html>
